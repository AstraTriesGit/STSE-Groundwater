---
title: "Combining Disjoint GWL Datasets"
output: pdf_document
---

Throughout the research process, we have acquired datasets from India-WRIS in the following order:
- May 2023 - May 2024
- May 2018 - May 2023
- May 2014 - May 2018
- May 2004 - May 2014 (6/9, TO BE RECEIVED)
```{r}
library(readxl)
library(dplyr)
library(purrr)
library(fs)
library(lobstr)
library(feather)
library(ggplot2)
library(tidyverse)
```

## Datatypes and `feather` Format Conversion
We read all the Excel files provided by India-WRIS and combined them into different `.feather` files depending
on the period and the measurement type (manual/telemetric.)
```{r}
# concatenate all Excel files in a period's telemetric folder
combine_telemetric <- function (excel_dir) {
  excel_files <- dir_ls(excel_dir, regexp = "\\.xlsx$")
  # concatenate the excel files
  combined <- excel_files %>%
    map_df(~ {
      data <- read_xlsx(.x)
      data %>% drop_na()
      return(data)
    })
  return (combined)
}

gwl_2023_24_telemetric <- combine_telemetric("data/CGWB_GWL_1-5-23_1-5-24/Telemetric")
write_feather(gwl_2023_24_telemetric, "data/combined/gwl_2023_24_telemetric.feather")

# changed datatype of station_code
col_spec <- rep("guess", 14)
col_spec[2] <- "text"
manual <- read_xlsx("data/CGWB_GWL_1-5-23_1-5-24/Manual/9. Manual GWL_CGWB_1 May 2023 to 1 May 2023.xlsx",
                    col_types = col_spec)
write_feather(manual, "data/combined/gwl_2023_24_manual.feather")

# warnings: expecting numeric got NULL, coercing text to numeric (NaN)
gwl_2018_23_telemetric <- combine_telemetric("data/GW Level Data 1 May 2018 to 1 May 2023/Telemetric Ground Water Level")
write_feather(gwl_2018_23_telemetric, "data/combined/gwl_2018_23_telemetric.feather")

manual <- read_xlsx("data/GW Level Data 1 May 2018 to 1 May 2023/Manual Ground Water Level/Manual Ground water Level from 1 May 2018 to 1 May 2023.xlsx",)
write_feather(manual, "data/combined/gwl_2018_23_manual.feather")

gwl_2014_18 <- read_csv("data/CGWB_GWL_DATA_MAY2014_MAY2018.csv")
write_feather(manual, "data/combined/gwl_2014_18.feather")
spec(gwl_2014_18)
```
We have created 5 `.feather` files and will assess the structure of the data in each file separately.

##







### Possible Grouping Strategies
In case a station's observations are of interest, their observations can be filtered by either of the following
primary keys:
- (latitude, longitude)
- (name, district, state)
- (station_code)

If I had to choose, I would prefer matching on (latitude, longitude) since it is central to our
calculations. Their biggest issue is floating point errors in comparisons, however.

